+++
title = "Day 9 - Making my own docker image, again"
template = "page.html"
date = 2022-06-19T04:00:00Z
[taxonomies]
tags = ["discord", "docker", "bot", "python", "#100DaysOfHomelab"]
+++

## Today's Problem:
Today's task for #100DaysOfHomelab was to re-spin up my custom discord bot that I've developed. As my eventual summary of my Days 1-7 post will entail, I completely wiped all 3 of my hypervisors on Day -1 (0?, not sure how these days are indexed). These were previously running Proxmox but, due to my problems with it and a [convincing video by Lawrence Systems](https://youtu.be/xB22GKGJkHY), I moved to XCP-ng. Unfortunately, this left all my services completely wiped, with only some backups. One of these down services was my discord bot. It's nothing fancy, just a python script that connects to a postgres database, but I recently moved it to docker so that I didn't need to waste a whole VM just on a python script.

However, when re-setting stuff up, I realized a few configuration variables had changed, and my docker image needed to be rebuilt. 
A quick google of all the docker commands I needed, I set off with a ``$ docker build .`` and didn't think much of it. Sadly, Portainer refused to import my image. When I imported it manually with docker it refused to boot it up as well.
Quite a bit of trial and error later, I realized I wasn't tagging my image. Apparently, both Docker for Mac and Portainer both hate this. I guess everything needs a tag. I'd previously built my image with a tag, but I'd not documented my process.
The commands I ended up looking for were
```
$ docker build -t example/example:1.0 .
$ docker save example/example:1.0 > example.tar
```
And this gave me the .tar file I could upload directly into Portainer.

Future steps for this discord bot would be to get a CI/CD pipeline running to auto-build and deploy this image, as well as some overall structural improvements to my release process and the image itself. 1G for a python bot is a lot of bloat, but I'm not lacking in storage space currently.